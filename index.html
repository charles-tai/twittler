<!DOCTYPE html>
<html>
  <head>
    <!-- javascript -->
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
    <script src="jquery.timeago.js" type="text/javascript"></script>
    <!-- css -->
    <link rel="stylesheet" href="style.css" type="text/css" media="screen, print"/>
    <link href='http://fonts.googleapis.com/css?family=Sorts+Mill+Goudy' rel='stylesheet' type='text/css'>
  </head>
  <body>
    <script>

$(document).ready(function(){

    var totalTweets = streams.home.length - 1
        , index = 0;

    displayTweets();

    function displayTweets() {

      var totalTweets = streams.home.length-1;

      while(index <= totalTweets) {
        var tweet = streams.home[index]
            , createdAt =  tweet.created_at.getHours()
            , $newTweet = $('<div id = \'messages\'></div>');

        $newTweet.html(
            '<p> <span id = \'userName\'>' + tweet.user + '</span>' +
            '<span id = \'light\'> @' + tweet.user  + '</span>' +
            '<br />' + tweet.message +
            '<br /><span id = \'light\'> ' + $.timeago(tweet.created_at) + '</span>' +
            '<br /> <b> tweet #:' + index + '</p>'
            );
        $newTweet.prependTo($('#newTweet')).effect('highlight',{color:'#FFFFCC'}, 1000);
        index++;
      }
    }

//// Show new tweets

    $('div#button').on('click', function() {
      displayTweets();
    });

    setInterval(function () {numOfTweets(streams.home.length-index)},1000);
    });

    function numOfTweets (count) {
      $('div#button').html('<div id = \'button\'><b>' + count + '<strong> new messages </strong>').slideDown('slow');
    };

//// Display user tweets

      $(document).on('click', '#userName', function() {
        var userName = $(this).text();
        var totalTweets = streams.home.length-1;
        $('#userTweet').empty();
        $('#userTweetName').html(userName);
        streams.users[userName].forEach( function (tweet) {
          var $userTweet = $('<div id = \'userTweet\'></div>');
          $userTweet.html(
              '<p> <span id = \'userName\'>' + tweet.user + '</span>' +
              '<span id = \'handle\'> @' + tweet.user  + '</span>' +
              '<br />' + tweet.message +
              '<br /><span id = \'light\'> ' + $.timeago(tweet.created_at) + '</span>'
              );
          $userTweet.prependTo($('#userTweet')).effect('highlight',{color:'#FFFFCC'}, 1000);;
        });
      });


//// Send tweets

      $(":button").on('click', function () {
        var message = $('input').val();
        alert('hello');
        // writeTweet(message);
      });


    </script>
    <form>
      Tweet:
      <input type = 'text' name = 'sendTweet'> </input>
      <button type = "button"> Send Tweet </button>
    </form>

    <div id = 'userTweet'><div id = 'userTweetName'></div></div>
    <div id = 'button'></div>
    <div class = 'numOfTweets'> </div>
    <div id = 'newTweet'></div>

  </body>

</html>
